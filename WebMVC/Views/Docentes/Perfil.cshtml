@model NextLevel.Compartidos.DTOs.Docentes.DocenteInfoDTO

@{
    ViewData["Title"] = "Perfil Docente";
    string tabActivo = TempData["TabActivo"]?.ToString() ?? "datos";
}

@section Header {
    @await Html.PartialAsync("~/Views/Home/Header.cshtml")
}

@section Styles {
<link rel="stylesheet" href="~/css/Docentes/Perfil.css" />
}

@section ScriptsJs {
<script src="~/js/Docentes/Perfil.js"></script>
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

@if(ViewBag.Error != null)
{
    <div class="d-flex">

        <!-- SIDEBAR -->
        <div class="sidebar-wrapper">
            <div class="sidebar-title">Mi Panel</div>

            <ul class="nav flex-column nav-pills">

                <li class="nav-item mb-2">
                    <a class="nav-link @(tabActivo == "datos" ? "active" : "")" data-bs-toggle="pill" href="#datos">
                        <i class="bi bi-person-circle"></i> Datos personales
                    </a>
                </li>

                <li class="nav-item mb-2">
                    <a class="nav-link @(tabActivo == "contra" ? "active" : "")" data-bs-toggle="pill" href="#contra">
                        <i class="bi bi-envelope-paper"></i> Recuperar contraseña
                    </a>
                </li>

            </ul>
        </div>



        <!-- CONTENIDO -->
        <div class="content-wrapper">
            <div class="tab-content">


                <!-- DATOS PERSONALES -->
                <div class="tab-pane fade @(tabActivo == "datos" ? "show active" : "")" id="datos">

                    <div class="section-card">
                        <h2 class="section-title">Datos personales</h2>
                        <hr />

                        <!-- MENSAJES -->
                        <div class="mensajes-form">
                            @if (TempData["ErrorDatosPersonales"] != null && !(bool)TempData["ErrorDatosPersonales"])
                            {
                                <div class="alert alert-success text-center mb-2 mt-3">
                                    @TempData["MensajeDatosPersonales"]
                                </div>
                            }

                            @if (TempData["ErrorDatosPersonales"] != null && (bool)TempData["ErrorDatosPersonales"])
                            {
                                <div class="alert alert-danger text-center mb-2 mt-3">
                                    @TempData["MensajeDatosPersonales"]
                                </div>

                                <script>
                                    // Mantener modo edición si hubo error del servidor
                                    document.addEventListener("DOMContentLoaded", () => {
                                    document.getElementById("vistaDatosDocente").style.display = "none";
                                    document.getElementById("formEditarDocente").style.display = "block";
                                    });
                                </script>
                            }
                        </div>

                        <!-- MODO LECTURA -->
                        <div id="vistaDatosDocente">
                            <dl class="row mt-4">

                                <dt class="col-sm-4">Nombre completo</dt>
                                <dd class="col-sm-8">@Model.NombreCompleto</dd>

                                <dt class="col-sm-4">Teléfono</dt>
                                <dd class="col-sm-8">@Model.Telefono</dd>

                                <dt class="col-sm-4">Número de docente</dt>
                                <dd class="col-sm-8">@Model.NroDocente</dd>

                            </dl>

                            <div class="text-center mt-4">
                                <button id="btnEditarDocente" class="btn btn-pastel">Editar datos</button>
                            </div>
                        </div>

                        <!-- MODO EDICIÓN -->
                        <form id="formEditarDocente" asp-controller="Docentes" asp-action="ActualizarDatos"
                        method="post" style="display:none;">

                            <div class="mt-4">

                                <div class="mb-3">
                                    <label class="fw-semibold">Nombre completo</label>
                                    <input class="form-control pastel-input" name="NombreCompleto"
                                    value="@Model.NombreCompleto" required />
                                </div>

                                <div class="mb-3">
                                    <label class="fw-semibold">Teléfono</label>
                                    <input class="form-control pastel-input" name="Telefono"
                                    value="@Model.Telefono" required />
                                </div>

                                <div class="mb-3">
                                    <label class="fw-semibold">Número de docente</label>

                                    <input class="form-control pastel-input"
                                    value="@Model.NroDocente"
                                    readonly
                                    style="background-color:#f2f2f2; cursor:not-allowed;" />

                                    <input type="hidden" name="NroDocente.NroDeDocente" value="@Model.NroDocente.NroDeDocente" />
                                </div>


                            </div>

                            <div class="d-flex justify-content-center gap-3 mt-4">
                                <button type="submit" class="btn btn-pastel">Guardar</button>
                                <button type="button" id="btnCancelarDocente" class="btn btn-danger">Cancelar</button>
                            </div>

                        </form>
                    </div>

                </div>



                <!-- CONTRASEÑA -->
                <div class="tab-pane fade @(tabActivo == "contra" ? "show active" : "")" id="contra">
                    <div class="section-card">

                        <h2 class="section-title">Restablecer contraseña</h2>
                        <hr />

                        <div class="mensajes-form mt-3">
                            @if (TempData["MensajeErrorRecuperarPassword"] != null && !(bool)TempData["MensajeErrorRecuperarPassword"])
                            {
                                <div class="alert alert-success text-center mb-2 mt-3">@TempData["MensajeRecuperarPassword"]</div>
                            }

                            @if (TempData["MensajeErrorRecuperarPassword"] != null && (bool)TempData["MensajeErrorRecuperarPassword"])
                            {
                                <div class="alert alert-danger text-center mb-2 mt-3">@TempData["MensajeRecuperarPassword"]</div>
                            }
                        </div>

                        <div class="info-box">
                            Por seguridad, te enviaremos un correo con un enlace para restablecer tu contraseña.
                        </div>

                        <form id="formRecuperar" asp-controller="Usuarios" asp-action="RecuperarCuenta" method="post">
                            <input hidden name="email" value="@Context.Session.GetString("emailLogueado")" />
                            <input hidden name="returnTo" value="Perfil" />
                            <button id="btnRecuperar" type="submit" class="btn btn-pastel">
                                <i class="bi bi-envelope-arrow-up"></i> Enviar email de recuperación
                            </button>
                        </form>

                    </div>
                </div>

            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-danger text-center mb-2 mt-3">@ViewBag.Error</div>
}
